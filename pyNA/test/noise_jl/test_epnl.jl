using BenchmarkTools
using Test

include("../../src/noise_src_jl/epnl.jl")

@testset "epnl module" begin
    
	## Test 1: example from the nasa stca 
    # Inputs
	t_o = [18.93, 19.43, 19.93, 20.43, 20.93, 21.43, 21.93, 22.43, 22.93, 23.43, 23.93, 24.43, 24.93, 25.43, 25.93, 26.43, 26.93, 27.43, 27.93, 28.43, 28.93, 29.43, 29.93, 30.43, 30.93, 31.43, 31.93, 32.43, 32.93, 33.43, 33.93, 34.43, 34.93, 35.43, 35.93, 36.43, 36.93, 37.43, 37.93, 38.43, 38.93, 39.43, 39.93, 40.43, 40.93, 41.43, 41.93, 42.43, 42.93, 43.43, 43.93, 44.43, 44.93, 45.43, 45.93, 46.43, 46.93, 47.43, 47.93, 48.43, 48.93, 49.43, 49.93, 50.43, 50.93, 51.43, 51.93, 52.43, 52.93, 53.43, 53.93, 54.43, 54.93, 55.43, 55.93, 56.43, 56.93, 57.43, 57.93, 58.43, 58.93, 59.43, 59.93, 60.43, 60.93, 61.43, 61.93, 62.43, 62.93, 63.43, 63.93, 64.43, 64.93, 65.43, 65.93, 66.43, 66.93, 67.43, 67.93, 68.43, 68.93, 69.43, 69.93, 70.43, 70.93, 71.43, 71.93, 72.43, 72.93, 73.43, 73.93, 74.43, 74.93, 75.43, 75.93, 76.43, 76.93, 77.43, 77.93, 78.43, 78.93, 79.43, 79.93, 80.43, 80.93, 81.43, 81.93, 82.43, 82.93, 83.43, 83.93, 84.43, 84.93, 85.43, 85.93, 86.43, 86.93, 87.43, 87.93, 88.43, 88.93, 89.43, 89.93, 90.43, 90.93, 91.43, 91.93, 92.43, 92.93, 93.43, 93.93, 94.43, 94.93, 95.43, 95.93, 96.43, 96.93, 97.43, 97.93, 98.43, 98.93, 99.43, 99.93,100.43,100.93,101.43,101.93,102.43,102.93,103.43,103.93,104.43,104.93,105.43,105.93,106.43,106.93,107.43,107.93,108.43,108.93,109.43,109.93,110.43,110.93,111.43,111.93,112.43,112.93,113.43,113.93,114.43,114.93,115.43,115.93,116.43,116.93,117.43,117.93,118.43,118.93,119.43,119.93,120.43,120.93,121.43,121.93,122.43,122.93,123.43,123.93,124.43,124.93,125.43,125.93,126.43,126.93,127.43,127.93,128.43,128.93,129.43,129.93,130.43,130.93,131.43,131.93,132.43,132.93,133.43,133.93,134.43,134.93,135.43,135.93,136.43,136.93,137.43,137.93,138.43,138.93,139.43,139.93,140.43,140.93,141.43,141.93,142.43,142.93,143.43,143.93,144.43,144.93,145.43,145.93,146.43]
	pnlt = [0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  0.00 ,  7.09 ,  7.74 ,  8.41 ,  9.09 ,  9.80 , 13.63 , 14.38 , 15.16 , 16.19 , 18.49 , 17.94 , 17.41 , 16.36 , 21.69 , 29.00 , 34.82 , 39.04 , 42.39 , 45.59 , 48.36 , 50.93 , 53.17 , 55.02 , 56.60 , 58.03 , 59.27 , 60.37 , 61.37 , 62.23 , 63.06 , 63.82 , 64.56 , 65.22 , 65.88 , 66.49 , 67.05 , 67.61 , 68.19 , 68.80 , 69.41 , 70.01 , 70.62 , 71.26 , 71.90 , 72.52 , 73.16 , 73.86 , 74.50 , 75.15 , 75.93 , 76.72 , 77.45 , 78.11 , 78.77 , 79.41 , 79.90 , 80.51 , 81.70 , 82.98 , 82.49 , 82.03 , 81.48 , 82.23 , 82.82 , 83.40 , 84.20 , 84.90 , 85.38 , 85.73 , 86.41 , 87.12 , 87.61 , 87.92 , 88.06 , 88.19 , 88.35 , 88.56 , 88.67 , 88.60 , 88.25 , 87.88 , 87.42 , 86.81 , 86.09 , 85.33 , 84.56 , 83.69 , 82.80 , 82.09 , 81.40 , 80.81 , 80.19 , 79.49 , 78.74 , 78.00 , 77.25 , 76.48 , 75.74 , 75.00 , 74.25 , 73.47 , 72.75 , 72.09 , 71.42 , 70.84 , 70.27 , 69.70 , 69.13 , 68.58 , 68.04 , 67.52 , 66.96 , 66.42 , 65.88 , 65.33 , 64.86 , 64.50 , 64.13 , 63.84 , 63.55 , 63.27 , 63.04 , 62.83 , 62.62 , 62.43 , 62.23 , 62.04 , 61.85 , 61.66 , 61.47 , 61.28 , 61.08 , 60.89 , 60.65 , 60.46 , 60.27 , 60.03 , 59.85 , 59.67 , 59.45 , 59.29 , 59.13 , 58.97 , 58.81 , 58.66 , 58.50 , 58.35 , 58.19 , 57.98 , 57.83 , 57.68 , 57.53 , 57.38 , 57.23 , 57.08 , 56.93 , 56.78 , 56.63 , 56.48 , 56.32 , 56.17 , 56.02 , 55.88 , 55.73 , 55.58 , 55.44 , 55.29 , 55.14 , 55.00 , 54.86 , 54.64 , 54.50 , 54.36 , 54.23 , 54.01 , 53.88 , 53.75 , 53.62 , 53.49 , 53.36 , 53.23 , 53.10 , 52.97 , 52.84 , 52.71 , 52.59 , 52.45 , 52.32 , 52.19 , 52.07 , 51.94 , 51.81 , 51.68 , 51.56 , 51.43 , 51.31 , 51.18 , 51.05 , 50.93 , 50.80 , 50.68 , 50.55 , 50.43 , 50.31 , 50.19 , 50.07 , 49.94 , 49.82 , 49.71 , 49.59 , 49.47 , 49.35]

	sol = f_epnl(t_o, pnlt)

	@test(isapprox(sol, 88.62), rtol=1e-2)

end
