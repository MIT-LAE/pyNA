using BenchmarkTools
using Test
using CSV
using DataFrames

include("../../src/noise_src_jl/lateral_attenuation.jl")

struct Settings_lat
	engine_mounting
end
settings = Settings_lat("none")

@testset "lateral attenuation module" begin
	
	## Test 1: example from the nasa stca    
	beta = 30.
	x_obs = [6500., 450., 1.2]
	spl_sb = ones(120,)

	lateral_attenuation!(spl_sb, settings, beta, x_obs)
	sol = [0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348, 0.9008870217229348]
	@test(isapprox(spl_sb, sol, rtol=1e-6))

end

## Test 2: timing
beta = 30.
x_obs = [6500., 450., 1.2]
spl_sb = ones(120,)

@btime lateral_attenuation!(spl_sb, settings, beta, x_obs)
